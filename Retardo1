; PIC18F4550 Configuration Bit Settings

; Assembly source line config statements
#include "p18f4550.inc"

; CONFIG1H
  CONFIG  FOSC = INTOSC_HS      ; Oscillator Selection bits (Internal oscillator, HS oscillator used by USB (INTHS))
  CONFIG  FCMEN = OFF           ; Fail-Safe Clock Monitor Enable bit (Fail-Safe Clock Monitor disabled)
  CONFIG  IESO = OFF            ; Internal/External Oscillator Switchover bit (Oscillator Switchover mode disabled)
  CONFIG  PBADEN = OFF         ; Configurar los pines de PORTB como digitales

    ORG     0x00                          ; Dirección de inicio
    
inicio:
    CLRF    TRISB       ; Configurar PORTB como salida (0 = salida, 1 = entrada)
    CLRF    LATB        ; Apagar todos los pines de PORTB (LED apagado inicialmente)
    
loop:
    BSF    LATB, RB0     ; Encender el RB0 registro  
    CALL Retardo_5s      ; Llamar a la subrutina de retardo de 5 segundos
    BCF LATB, RB0        ; Apagar el RB0 registro
    GOTO loop            ; Repetir el bucle infinitamente
    
    
   

; Subrutina de retardo 1s

Retardo_1s:
    MOVLW   25          ; Cargar el valor 25 en el registro W (contador externo)
    MOVWF   ContadorExterno  ; Guardar el valor en la variable ContadorExterno

LoopExterno:
    MOVLW   250         ; Cargar el valor 250 en el registro W (contador interno)
    MOVWF   ContadorInterno  ; Guardar el valor en la variable ContadorInterno

LoopInterno:
    NOP                 ; No hacer nada (consume un ciclo de instrucción)
    NOP                 ; No hacer nada (consume otro ciclo)
    NOP                 ; No hacer nada (consume otro ciclo)
    
    DECFSZ  ContadorInterno, F  ; Decrementar ContadorInterno, si es cero, salta la siguiente instrucción
    GOTO    LoopInterno         ; Si no es cero, repetir el bucle interno

    DECFSZ  ContadorExterno, F  ; Decrementar ContadorExterno, si es cero, salta la siguiente instrucción
    GOTO    LoopExterno         ; Si no es cero, repetir el bucle externo

    RETURN              ; Retornar al programa principal después del retardo

; =======================
; Definición de Variables
; =======================

PSECT udata  ; Sección de datos sin inicializar (variables en RAM)
    ContadorExterno  RES 1   ; Reserva 1 byte de memoria para el contador externo
    ContadorInterno  RES 1   ; Reserva 1 byte de memoria para el contador interno

    END            ; Fin del código
